{% extends "base.html" %}

<!--
█████████████████████████████████████████████████████████████████████
█▄─▄███▄─▄█▄─▄─▀█▄─▄▄▀██▀▄─██▄─▄▄▀█▄─█─▄█████─█─█─▄─▄─█▄─▀█▀─▄█▄─▄███
██─██▀██─███─▄─▀██─▄─▄██─▀─███─▄─▄██▄─▄██░░██─▄─███─████─█▄█─███─██▀█
▀▄▄▄▄▄▀▄▄▄▀▄▄▄▄▀▀▄▄▀▄▄▀▄▄▀▄▄▀▄▄▀▄▄▀▀▄▄▄▀▀▄▄▀▀▄▀▄▀▀▄▄▄▀▀▄▄▄▀▄▄▄▀▄▄▄▄▄▀
-->

{% block title %}Gallery{% endblock %}

{% block main %}
<body>
    {% include 'nav.html' %}
    <div class="page-container" style="margin-top: 50px;">

        <header class="gallery-page-header">
            <h1 class="gallery-page-title">My Full Art Gallery</h1>
            <p class="gallery-page-subtitle">Art of me!</p>
        </header>

        <div class="gallery-menubar-wrapper" style="margin-bottom: 20px; margin-top: 20px;">
            <div class="gallery-menubar">
                <div class="gallery-aspect-ratio-buttons">
                    <button class="gallery-aspect-ratio-btn selected" aspectToSet="3/4">
                        <div class="gallery-aspect-ratio-preview" style="aspect-ratio: 3/4; transform: scale(0.7);"></div>
                    </button>
                    <button class="gallery-aspect-ratio-btn" aspectToSet="1/1">
                        <div class="gallery-aspect-ratio-preview" style="aspect-ratio: 1/1; transform: scale(0.7);"></div>
                    </button>
                    <button class="gallery-aspect-ratio-btn" aspectToSet="4/3">
                        <div class="gallery-aspect-ratio-preview" style="aspect-ratio: 4/3; transform: scale(0.7);"></div>
                    </button>
                    <button class="gallery-aspect-ratio-btn" aspectToSet="16/9">
                        <div class="gallery-aspect-ratio-preview" style="aspect-ratio: 16/9; transform: scale(0.7);"></div>
                    </button>
                </div>
            </div>

            <div class="gallery-menubar">
                <div class="gallery-item gallery-search">
                    <input id="gallery-search-input" class="gallery-search-input" type="search" placeholder="Search art name..." aria-label="Search art name">
                </div>

                <div class="gallery-item gallery-filter">
                    <button id="gallery-filter-toggle" class="gallery-filter-toggle" aria-haspopup="true" aria-expanded="false"><span>Filters</span><span>▾</span></button>

                    <div id="gallery-filter-popup" class="gallery-filter-popup" role="dialog" aria-modal="false" aria-hidden="true">
                        <div class="gallery-filter-row">
                            <label class="gallery-label">Characters</label>
                            <div id="gallery-characters-list" class="gallery-multiselect"></div>
                        </div>

                        <div class="gallery-filter-row">
                            <label for="gallery-artist-select" class="gallery-label">Artist</label>
                            <div class="gallery-dropdown-custom" data-select-id="gallery-artist-select">
                                <div class="gallery-dropdown-selected">
                                    <span class="gallery-dropdown-option-label">— Any —</span>
                                    <span class="gallery-dropdown-arrow">▾</span>
                                </div>
                                <ul class="gallery-dropdown-options"></ul>
                                <select id="gallery-artist-select" class="gallery-dropdown-select-hidden">
                                    <option value="">— Any —</option>
                                </select>
                            </div>
                        </div>

                        <div class="gallery-filter-row">
                            <label for="gallery-form-select" class="gallery-label">Form</label>
                            <div class="gallery-dropdown-custom" data-select-id="gallery-form-select">
                                <div class="gallery-dropdown-selected">
                                    <span class="gallery-dropdown-option-label">— Any —</span>
                                    <span class="gallery-dropdown-arrow">▾</span>
                                </div>
                                <ul class="gallery-dropdown-options"></ul>
                                <select id="gallery-form-select" class="gallery-dropdown-select-hidden">
                                    <option value="">— Any —</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="gallery-filter-row">
                            <label class="gallery-label">Toggles</label>
                            <div class="gallery-filter-row gallery-filter-row-inline">
                                <div class="gallery-tristate">
                                    <label class="gallery-label">NSFW</label>
                                    <button id="gallery-nsfw-toggle" class="gallery-tri-btn" data-state="neutral" aria-pressed="false" title="Toggle NSFW filter (neutral → include → exclude)">─</button>
                                </div>

                                <div class="gallery-tristate">
                                    <label class="gallery-label">AI</label>
                                    <button id="gallery-ai-toggle" class="gallery-tri-btn" data-state="neutral" aria-pressed="false" title="Toggle AI filter (neutral → include → exclude)">─</button>
                                </div>

                                <div class="gallery-tristate">
                                    <label class="gallery-label">Discord</label>
                                    <button id="gallery-discord-toggle" class="gallery-tri-btn" data-state="neutral" aria-pressed="false" title="Toggle Discord filter (neutral → include → exclude)">─</button>
                                </div>
                            </div>
                        </div>

                        <div class="gallery-filter-actions">
                            <button id="gallery-reset-btn" class="gallery-action-btn">Reset</button>
                            <button id="gallery-apply-btn" class="gallery-action-btn gallery-primary">Apply</button>
                        </div>
                    </div>
                </div>

                <!-- quick character dropdown (also usable separately) -->
                <div class="gallery-item gallery-characters-dropdown">
                    <button id="gallery-characters-toggle" class="gallery-dropdown-toggle"><span>Characters</span><span>▾</span></button>
                    <div id="gallery-characters-popup" class="gallery-popup" aria-hidden="true"></div>
                </div>

                <!-- Artist quick dropdown -->
                <div class="gallery-item gallery-artist-dropdown">
                    <div class="gallery-dropdown-custom" data-select-id="gallery-artist-quick">
                        <div class="gallery-dropdown-selected">
                            <span class="gallery-dropdown-option-label">Artist — Any</span>
                            <span class="gallery-dropdown-arrow">▾</span>
                        </div>
                        <ul class="gallery-dropdown-options"></ul>
                        <select id="gallery-artist-quick" class="gallery-dropdown-select-hidden">
                            <option value="">Artist — Any</option>
                        </select>
                    </div>
                </div>

                <!-- Form quick dropdown -->
                <div class="gallery-item gallery-form-dropdown">
                    <div class="gallery-dropdown-custom" data-select-id="gallery-form-quick">
                        <div class="gallery-dropdown-selected">
                            <span class="gallery-dropdown-option-label">Form — Any</span>
                            <span class="gallery-dropdown-arrow">▾</span>
                        </div>
                        <ul class="gallery-dropdown-options"></ul>
                        <select id="gallery-form-quick" class="gallery-dropdown-select-hidden">
                            <option value="">Form — Any</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="gallery library" id="gallery"></div>
    </div>

    {% include 'viewer.html' %}

    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/galleryControls.js') }}"></script>
    <script>initGalleryDropdowns()</script>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const galleryButtons = document.querySelectorAll('.gallery-aspect-ratio-btn');

        galleryButtons.forEach(button => {
            button.addEventListener('click', () => {
                var galleryThumbs = document.querySelectorAll('#gallery .thumb');

                // Remove 'selected' class from all buttons
                galleryButtons.forEach(btn => btn.classList.remove('selected'));

                // Add 'selected' class to the clicked button
                button.classList.add('selected');

                // Get the aspect ratio from the data attribute
                const aspectRatio = button.getAttribute('aspectToSet');

                // Apply the new aspect ratio to all gallery thumbnails
                galleryThumbs.forEach(thumb => {
                    thumb.style.aspectRatio = aspectRatio;
                });
            });
        });
    });
</script>
<!-- Image Link Scripts -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const params = new URLSearchParams(window.location.search);
    const imageId = params.get("id");

    if (!imageId) return;

    try {
        const res = await fetch("/art.json");
        const images = await res.json();

        const img = images.find(x => String(x.id) === String(imageId));
        if (img) {
            openViewer(img);
        }
    } catch (err) {
        console.error("Error loading image for viewer:", err);
    }
});
</script>
{% endblock %}
